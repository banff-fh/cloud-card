<?xml version="1.0" encoding="UTF-8"?>
<entitymodel xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="http://ofbiz.apache.org/dtds/entitymodel.xsd">
    <!-- ========================================================= -->
    <!-- ======================== Defaults ======================= -->
    <!-- ========================================================= -->
    <title>Entity of cloudcard Component</title>
    <description>None</description>
    <copyright></copyright>
    <version></version>
	<view-entity entity-name="CloudCardInfo" package-name="org.ofbiz.accounting.finaccount" title="cloud card info">
        <description>
        云卡视图（金融账户、金融账户角色、礼品卡关联）
        FinAccount And PaymentMethod And GiftCard
        </description>
        <member-entity entity-alias="FA" entity-name="FinAccount"/>
        <member-entity entity-alias="FAR" entity-name="FinAccountRole"/>
        <member-entity entity-alias="PM" entity-name="PaymentMethod"/>
      	<member-entity entity-alias="GC" entity-name="GiftCard"/>
      	<member-entity entity-alias="PG" entity-name="PartyGroup"/>
      	<member-entity entity-alias="PER" entity-name="Person"/>
      	<alias entity-alias="FA" name="finAccountId" />
      	<alias entity-alias="FA" name="ownerPartyId" />
      	<alias entity-alias="PER" name="lastName" />
      	<alias entity-alias="PER" name="firstName" />
      	<alias entity-alias="FA" name="finAccountTypeId" />
      	<alias entity-alias="FA" name="statusId" />
      	<alias entity-alias="FA" name="finAccountName" />
      	<alias entity-alias="FA" name="organizationPartyId" />
      	<alias entity-alias="FA" name="finAccountCode" />
      	<alias entity-alias="FA" name="actualBalance" />
      	<alias entity-alias="FA" name="availableBalance" />
      	<alias entity-alias="FAR" name="distributorPartyId" field="partyId" />
      	<alias entity-alias="PG" name="distributorPartyName" field="groupName" />
      	<alias entity-alias="PG" name="logoImageUrl"/>
		<alias entity-alias="PM" name="paymentMethodId" />
		<alias entity-alias="PM" name="paymentMethodTypeId" />
		<alias entity-alias="PM" name="partyId" />
		<alias entity-alias="PM" name="description" />
		<alias entity-alias="PM" name="fromDate" />
		<alias entity-alias="PM" name="thruDate" />
		<alias entity-alias="GC" name="cardNumber" />
		<alias entity-alias="GC" name="pinNumber" />
		<alias entity-alias="GC" name="expireDate" />
		<view-link entity-alias="FA" rel-entity-alias="FAR">
			<key-map field-name="finAccountId" rel-field-name="finAccountId" />
			<entity-condition>
				<condition-expr entity-alias="FAR" field-name="roleTypeId" operator="equals" value="DISTRIBUTOR"/>
			</entity-condition>
		</view-link>
		<view-link entity-alias="FA" rel-entity-alias="PM" rel-optional="true">
			<key-map field-name="finAccountId" rel-field-name="finAccountId" />
			<entity-condition>
				<condition-expr entity-alias="FA" field-name="finAccountTypeId" operator="equals" value="GIFTCERT_ACCOUNT"/>
			</entity-condition>
		</view-link>
		<view-link entity-alias="PM" rel-entity-alias="GC" rel-optional="true">
			<key-map field-name="paymentMethodId" />
		</view-link>
		<view-link entity-alias="FAR" rel-entity-alias="PG">
			<key-map field-name="partyId" />
		</view-link>
		<view-link entity-alias="FA" rel-entity-alias="PER">
			<key-map field-name="ownerPartyId"  rel-field-name="partyId"/>
		</view-link>

		<relation type="one-nofk" rel-entity-name="Person">
			<key-map field-name="ownerPartyId" rel-field-name="partyId" />
		</relation>
		<relation type="one-nofk" rel-entity-name="PaymentMethod">
			<key-map field-name="paymentMethodId" />
		</relation>
		<relation type="one-nofk" rel-entity-name="PaymentMethodType">
			<key-map field-name="paymentMethodTypeId" />
		</relation>
		<relation type="one-nofk" rel-entity-name="GiftCard">
			<key-map field-name="paymentMethodId" />
		</relation>
    </view-entity>
	
	
	<view-entity entity-name="TelecomNumberAndUserLogin"
        package-name="org.ofbiz.party.contact"
        title="根据会员电话号码查询userlogin">
        <member-entity entity-alias="PCMP" entity-name="PartyContactMechPurpose"/>
        <member-entity entity-alias="TN" entity-name="TelecomNumber"/>
        <member-entity entity-alias="PTY" entity-name="Party"/>
        <member-entity entity-alias="ULN" entity-name="UserLogin"/>
        <alias-all entity-alias="PCMP"/>
        <alias-all entity-alias="TN"/>
        <alias entity-alias="PTY" name="partyId"/>
        <alias entity-alias="PTY" name="partyTypeId"/>
        <alias entity-alias="ULN" name="userLoginId"/>
        <alias entity-alias="ULN" name="enabled"/>
        <view-link entity-alias="PCMP" rel-entity-alias="TN">
            <key-map field-name="contactMechId"/>
            <entity-condition>
                <condition-expr field-name="contactMechPurposeTypeId" operator="equals" value="AS_USER_LOGIN_ID"/>
            </entity-condition>
        </view-link>
        <view-link entity-alias="PCMP" rel-entity-alias="PTY">
            <key-map field-name="partyId"/>
        </view-link>
        <view-link entity-alias="PTY" rel-entity-alias="ULN">
            <key-map field-name="partyId"/>
        </view-link>
        <relation type="one-nofk" rel-entity-name="Party">
            <key-map field-name="partyId"/>
        </relation>
        <relation type="one-nofk" rel-entity-name="UserLogin">
            <key-map field-name="userLoginId"/>
        </relation>
    </view-entity>
    
    <entity entity-name="SmsValidateCode" package-name="org.ofbiz.cloudcard.sms" title="短信验证码">
		<description>短信验证码，过期的 且 isValid=Y 的数据都可以清理</description>
		<field name="teleNumber" type="id"></field>
		<field name="smsType" type="id"></field>
		<field name="captcha" type="id"></field>
		<field name="isValid" type="id"></field>
		<field name="fromDate" type="date-time"></field>
      	<field name="thruDate" type="date-time"></field>
      	<prim-key field="teleNumber"/>
      	<prim-key field="captcha"/>
	    <prim-key field="fromDate"/>
	</entity>
	
	
	<view-entity entity-name="CreateStoreApplyView" package-name="org.ofbiz.content.survey"
            title="云卡开店申请视图">
      <member-entity entity-alias="SR" entity-name="SurveyResponse"/>
      <member-entity entity-alias="SRAN" entity-name="SurveyResponseAnswer"/>
      <member-entity entity-alias="SRAT" entity-name="SurveyResponseAnswer"/>
      <member-entity entity-alias="SRAA" entity-name="SurveyResponseAnswer"/>
      
      <alias-all entity-alias="SR"/>
      
      <alias entity-alias="SRAN" name="storeName"  field="textResponse"/>
      <alias entity-alias="SRAT" name="teleNumber" field="textResponse"/>
      <alias entity-alias="SRAA" name="address" field="textResponse"/>
      
      <view-link entity-alias="SR" rel-entity-alias="SRAN">
        <key-map field-name="surveyResponseId"/>
        <entity-condition>
			<condition-expr entity-alias="SRAN" field-name="surveyQuestionId" operator="equals" value="SQ_CC_STORE_NAME"/>
		</entity-condition>
      </view-link>
      <view-link entity-alias="SR" rel-entity-alias="SRAT">
        <key-map field-name="surveyResponseId"/>
        <entity-condition>
			<condition-expr entity-alias="SRAT" field-name="surveyQuestionId" operator="equals" value="SQ_CC_S_OWNER_TEL"/>
		</entity-condition>
      </view-link>
      <view-link entity-alias="SR" rel-entity-alias="SRAA">
        <key-map field-name="surveyResponseId"/>
        <entity-condition>
			<condition-expr entity-alias="SRAA" field-name="surveyQuestionId" operator="equals" value="SQ_CC_STORE_ADDR"/>
		</entity-condition>
      </view-link>
      <relation type="one-nofk" rel-entity-name="Survey">
        <key-map field-name="surveyId"/>
      </relation>
      <relation type="one-nofk" rel-entity-name="SurveyQuestion">
        <key-map field-name="surveyQuestionId"/>
      </relation>
      <relation type="one-nofk" rel-entity-name="SurveyResponse">
          <key-map field-name="surveyResponseId"/>
      </relation>
    </view-entity>
	
	
	<!-- 废弃 -->
	<view-entity entity-name="CloudCardCrossStorePaymentView" package-name="org.ofbiz.cloudcard.payment" title="跨店流水">
		<description>
			所有跨店消费的未结算流水
				即 支付所用的云卡的 发卡商家  与 支付的 party_id_to 不相等statusId 为 PMNT_NOT_PAID 或 PMNT_SENT 的记录
		</description>
		<member-entity entity-alias="P" entity-name="Payment"/>
		<member-entity entity-alias="PM" entity-name="PaymentMethod"/>
		<member-entity entity-alias="FA" entity-name="FinAccount"/>
		<member-entity entity-alias="FAR" entity-name="FinAccountRole"/>
		<alias entity-alias="P" name="paymentId" />
		<alias entity-alias="P" name="paymentMethodTypeId" />
		<alias entity-alias="P" name="cardId" field="paymentMethodId" ><description>paymentMethodId即是云卡id</description></alias>
		<alias entity-alias="P" name="partyIdFrom" />
		<alias entity-alias="P" name="tradePartyId"  field="partyIdTo"><description>交易所在商家</description></alias>
		<alias entity-alias="P" name="effectiveDate" />
		<alias entity-alias="P" name="amount" />
		<alias entity-alias="P" name="currencyUomId" />
		<alias entity-alias="P" name="statusId" />
		<alias entity-alias="P" name="comments" />
		<alias entity-alias="PM" name="cardName"  field="description"/>
		<alias entity-alias="PM" name="customerPartyId" field="partyId"><description>持卡人、客户</description></alias>
		<alias entity-alias="FAR" name="distributorPartyId" field="partyId"><description>发行卡的商家</description></alias>
		
		<view-link entity-alias="P" rel-entity-alias="PM">
			<key-map field-name="paymentMethodId" />
			<entity-condition>
				<condition-list>
					<!-- 只查交易流水， paymentTypeId = GC_WITHDRAWAL -->
					<condition-expr field-name="paymentTypeId" operator="equals" value="GC_WITHDRAWAL"/>
					<condition-list combine="or">
						<condition-expr field-name="statusId" operator="equals" value="PMNT_SENT"/>
						<condition-expr field-name="statusId" operator="equals" value="PMNT_P_NOT_RCV_SENT"/>
						<condition-expr field-name="statusId" operator="equals" value="PMNT_P_NOT_SENT_RCV"/>
					</condition-list>
				</condition-list>
			</entity-condition>
		</view-link>
		
		<view-link entity-alias="PM" rel-entity-alias="FA">
			<key-map field-name="finAccountId" />
		</view-link>
		
		<view-link entity-alias="FA" rel-entity-alias="FAR">
			<key-map field-name="finAccountId" rel-field-name="finAccountId" />
			<entity-condition>
				<condition-list combine="and">
					<condition-expr entity-alias="FAR" field-name="roleTypeId" operator="equals" value="DISTRIBUTOR"/>
					<condition-expr entity-alias="P" field-name="partyIdTo" operator="not-equals" rel-entity-alias="FAR" rel-field-name="partyId"/>
				</condition-list>
			</entity-condition>
		</view-link>
		<relation type="one-nofk" rel-entity-name="PaymentMethod">
			<key-map field-name="paymentMethodId" />
		</relation>
		<relation type="one-nofk" rel-entity-name="FinAccount">
			<key-map field-name="finAccountId" />
		</relation>
	</view-entity>
	
	
	<!-- 废弃 -->
	<view-entity entity-name="CloudCardPlatformAccountReceivableView" package-name="org.ofbiz.cloudcard.payment" title="平台对商家应收金额统计视图">
		<description>
			用于查询平台对各个商家应收金额
		</description>
		<member-entity entity-alias="AR" entity-name="CloudCardCrossStorePaymentView"/>
		
		<alias entity-alias="AR" name="partyId" field="distributorPartyId" group-by="true"></alias>
		<alias entity-alias="AR" name="arAmount" function="sum" >
			<description>平台应从商家收取金额</description>
			<complex-alias operator="">
				<complex-alias-field entity-alias="AR"  field="amount" default-value="0"/>
			</complex-alias>
		</alias>
		<alias entity-alias="AR" name="arCount"  function="count" field="paymentId">
			<description>平台应收那部分支付流水的总条数</description>
		</alias>
		<entity-condition>
			<condition-list combine="or">
				<condition-expr entity-alias="AR" field-name="statusId" operator="equals" value="PMNT_SENT"/>
				<condition-expr entity-alias="AR" field-name="statusId" operator="equals" value="PMNT_P_NOT_RCV_SENT"/>
			</condition-list>
		</entity-condition>
		
	</view-entity>
	
	<!-- 废弃 -->
	<view-entity entity-name="CloudCardPlatformAccountPayableView" package-name="org.ofbiz.cloudcard.payment" title="平台对商家应付金额统计视图">
		<description>
			用于查询平台对各个商家应付金额
		</description>
		<member-entity entity-alias="AP" entity-name="CloudCardCrossStorePaymentView"/>
		
		<alias entity-alias="AP" name="partyId" field="tradePartyId" group-by="true"></alias>
		<alias entity-alias="AP" name="apAmount" function="sum" >
			<description>平台应付商家金额</description>
			<complex-alias operator="">
				<complex-alias-field entity-alias="AP"  field="amount" default-value="0"/>
			</complex-alias>
		</alias>
		<alias entity-alias="AP" name="apCount"  function="count" field="paymentId">
			<description>平台应付那部分支付流水的总条数</description>
		</alias>
		<entity-condition>
			<condition-list combine="or">
				<condition-expr entity-alias="AP" field-name="statusId" operator="equals" value="PMNT_SENT"/>
				<condition-expr entity-alias="AP" field-name="statusId" operator="equals" value="PMNT_P_NOT_SENT_RCV"/>
			</condition-list>
		</entity-condition>
		
	</view-entity>
	
	
	<!-- 废弃 -->
	<view-entity entity-name="CloudCardPlatformArApView" package-name="org.ofbiz.cloudcard.payment" title="平台对商家应收应付金额统计视图">
		<description>
			用于查询平台对各个商家应收应付金额
		</description>
		<member-entity entity-alias="PG" entity-name="PartyGroup"/>
		<member-entity entity-alias="PR" entity-name="PartyRole"/>
		<member-entity entity-alias="AR" entity-name="CloudCardPlatformAccountReceivableView"/>
		<member-entity entity-alias="AP" entity-name="CloudCardPlatformAccountPayableView"/>

		<alias entity-alias="PG" name="partyId" />
		<alias entity-alias="PG" name="groupName" />
		
		<alias entity-alias="AR" name="arAmount" >
			<complex-alias operator="">
				<complex-alias-field entity-alias="AR"  field="arAmount" default-value="0"/>
			</complex-alias>
		</alias>
		<alias entity-alias="AR" name="arCount" >
			<complex-alias operator="">
				<complex-alias-field entity-alias="AR"  field="arCount" default-value="0"/>
			</complex-alias>
		</alias>
		
		<alias entity-alias="AP" name="apAmount" >
			<complex-alias operator="">
				<complex-alias-field entity-alias="AP"  field="apAmount" default-value="0"/>
			</complex-alias>
		</alias>
		<alias entity-alias="AP" name="apCount" >
			<complex-alias operator="">
				<complex-alias-field entity-alias="AP"  field="apCount" default-value="0"/>
			</complex-alias>
		</alias>

		<alias name="reconciliationAmount" >
			<description>实际结算金额，为正表示需要从商家收款，为负表示需要付款给商家</description>
			<complex-alias operator="-">
				<complex-alias-field entity-alias="AR"  field="arAmount" default-value="0"/>
				<complex-alias-field entity-alias="AP"  field="apAmount" default-value="0"/>
			</complex-alias>
		</alias>
		<view-link entity-alias="PG" rel-entity-alias="PR">
			<key-map field-name="partyId"  />
			<entity-condition>
				<condition-expr entity-alias="PR" field-name="roleTypeId" operator="equals" value="DISTRIBUTOR"/>
			</entity-condition>
		</view-link>
		
		<view-link entity-alias="PG" rel-entity-alias="AR" rel-optional="true">
			<key-map field-name="partyId" />
		</view-link>
		
		<view-link entity-alias="PG" rel-entity-alias="AP" rel-optional="true">
			<key-map field-name="partyId" />
		</view-link>
		
	</view-entity>
	
	<!-- 扩展app消息状态 -->
	<extend-entity entity-name="PartyNote">
		<field name="isViewed" type="indicator" />
		<field name="removed" type="indicator" />
	</extend-entity>
	
	<view-entity entity-name="PartyNoteView2" package-name="org.ofbiz.cloudcard.note">
		<member-entity entity-alias="PN" entity-name="PartyNote" />
		<member-entity entity-alias="ND" entity-name="NoteData" />
		<alias-all entity-alias="PN" />
		<alias-all entity-alias="ND" />
		<view-link entity-alias="PN" rel-entity-alias="ND">
			<key-map field-name="noteId" />
		</view-link>
	</view-entity>
	
	<view-entity entity-name="PartyContentAndDataResourceDetail" package-name="org.ofbiz.content.content" title="Party Content Detail View Entity">
        <member-entity entity-alias="PCT" entity-name="PartyContent"/>
        <member-entity entity-alias="CNT" entity-name="Content"/>
        <member-entity entity-alias="DRC" entity-name="DataResource"/>
        
        <alias entity-alias="PCT" name="partyId" field="partyId"/>
        <alias entity-alias="PCT" name="partyContentTypeId" field="partyContentTypeId"/>
        <alias entity-alias="CNT" name="statusId" field="statusId"/>
        <alias entity-alias="CNT" name="contentId" field="contentId"/>
        <alias entity-alias="CNT" name="contentTypeId" field="contentTypeId"/>
        <alias entity-alias="DRC" name="dataResourceName" field="dataResourceName"/>
        <alias entity-alias="DRC" name="objectInfo" field="objectInfo"/>
        
        <view-link entity-alias="PCT" rel-entity-alias="CNT">
            <key-map field-name="contentId"/>
        </view-link>
        
        <view-link entity-alias="CNT" rel-entity-alias="DRC">
            <key-map field-name="dataResourceId"/>
        </view-link>
        
        <relation type="one-nofk" rel-entity-name="ContentType">
            <key-map field-name="contentTypeId"/>
        </relation>
    </view-entity>
    
    <!-- 获取PartyClassificationAndPartyClassificationGroup -->
   	<view-entity entity-name="PartyClassificationAndPartyClassificationGroup" package-name="org.ofbiz.party" title="Party Classification View Entity">
       <member-entity entity-alias="PC" entity-name="PartyClassification"/>
       <member-entity entity-alias="PCG" entity-name="PartyClassificationGroup"/>
       
       <alias entity-alias="PC" name="partyId" field="partyId"/>
       <alias entity-alias="PC" name="fromDate" field="fromDate"/>
       <alias entity-alias="PC" name="thruDate" field="thruDate"/>
       <alias entity-alias="PCG" name="description" field="description"/>
       <alias entity-alias="PCG" name="partyClassificationTypeId" field="partyClassificationTypeId"/>
       <alias entity-alias="PCG" name="partyClassificationGroupId" field="partyClassificationGroupId"/>
       
       <view-link entity-alias="PCG" rel-entity-alias="PC">
           <key-map field-name="partyClassificationGroupId"/>
       </view-link>
      
    </view-entity>
    
    <entity entity-name="CloudcardSettlementPeriod" package-name="org.ofbiz.accounting" title="商家之间结算时间 ">
		<description>商家与商家之间自定义结算时间</description>
		<field name="partyIdTo" type="id"></field>
		<field name="partyIdFrom" type="id"></field>
		<field name="status" type="id-ne"></field>
		<field name="week" type="numeric"></field>
		<field name="hour" type="numeric"></field>
      	<prim-key field="partyIdTo"/>
      	<prim-key field="partyIdFrom"/>
	</entity>
    
</entitymodel>